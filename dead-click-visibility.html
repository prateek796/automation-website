<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dead Click Visibility Test - Robust Harness</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .test-case { display: flex; align-items: center; margin-bottom: 18px; }
    .test-box {
      min-width: 180px;
      min-height: 40px;
      margin-right: 18px;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      border: 2px solid #222;
      outline: 2px solid #ff0;
      font-weight: bold;
      font-size: 15px;
      cursor: pointer;
      box-sizing: border-box;
      background: #888;
      transition: none;
    }
    .result-message {
      min-width: 120px;
      font-size: 14px;
      font-weight: normal;
      color: #222;
      background: #fffbe6;
      border: 1px solid #ffe58f;
      border-radius: 4px;
      padding: 2px 8px;
      margin-left: 10px;
      display: inline-block;
    }
    .test-label { min-width: 220px; font-size: 14px; color: #333; }
    .sim-btn { margin-left: 10px; padding: 2px 10px; font-size: 13px; border-radius: 4px; border: 1px solid #888; background: #e6f7ff; cursor: pointer; }
    .test-box.case1 { background: #2ecc40; }
    .test-box.case2 { background: #ff4136; }
    .test-box.case3 { background: #ff851b; }
    .test-box.case4 { background: #0074d9; }
    .test-box.case5 { background: #b10dc9; }
    .test-box.case6 { background: #111; }
    .test-box.case7 { background: #39cccc; }
    .test-box.case8 { background: #3d9970; }
    .test-box.case9, .test-box.case10 { background: #aaa; color: #333; cursor: default; }
    .log-area { margin-top: 30px; background: #f7f7f7; border: 1px solid #ccc; border-radius: 6px; padding: 12px 18px; font-size: 15px; max-width: 700px; min-height: 60px; color: #333; font-family: monospace; white-space: pre-line; }
  </style>
</head>
<body>
  <h2>Dead Click Visibility Test Harness</h2>
  <p>Click any box to test <code>deadClickUtils.isNodeVisible</code> logic. Console and UI will show all details. <br>Cases 9/10 are simulated via buttons.</p>

  <div id="test-cases">
    <div class="test-case"><div id="case-1" class="test-box case1">Case 1</div><span class="test-label">Transitioning, display & visibility valid, opacity/size 0</span><span class="result-message" id="msg-1"></span></div>
    <div class="test-case"><div id="case-2" class="test-box case2">Case 2</div><span class="test-label">Transitioning, display: none</span><span class="result-message" id="msg-2"></span></div>
    <div class="test-case"><div id="case-3" class="test-box case3">Case 3</div><span class="test-label">Transitioning, visibility: hidden</span><span class="result-message" id="msg-3"></span></div>
    <div class="test-case"><div id="case-4" class="test-box case4">Case 4</div><span class="test-label">Not transitioning, fully visible</span><span class="result-message" id="msg-4"></span></div>
    <div class="test-case"><div id="case-5" class="test-box case5">Case 5</div><span class="test-label">Not transitioning, opacity: 0</span><span class="result-message" id="msg-5"></span></div>
    <div class="test-case"><div id="case-6" class="test-box case6">Case 6</div><span class="test-label">Not transitioning, width/height: 0</span><span class="result-message" id="msg-6"></span></div>
    <div class="test-case"><div id="case-7" class="test-box case7">Case 7</div><span class="test-label">Empty transition, opacity: 0</span><span class="result-message" id="msg-7"></span></div>
    <div class="test-case"><div id="case-8" class="test-box case8">Case 8</div><span class="test-label">Transitioning on unrelated property, all good</span><span class="result-message" id="msg-8"></span></div>
    <div class="test-case"><button class="sim-btn" onclick="testCase9()">Test Case 9</button><span class="test-label">Not an HTMLElement (text node)</span><span class="result-message" id="msg-9"></span></div>
    <div class="test-case"><button class="sim-btn" onclick="testCase10()">Test Case 10</button><span class="test-label">Node is null/undefined</span><span class="result-message" id="msg-10"></span></div>
  </div>

  <div class="log-area" id="log-area"></div>

  <script>
    // --- Utility ---
    const deadClickUtils = {
      isNodeVisible(node) {
        if (!node || !(node instanceof HTMLElement)) {
          return false;
        }
        const computedStyle = window.getComputedStyle(node);
        const boundingClientRect = node.getBoundingClientRect();
        const isTransitioning = computedStyle?.transition !== 'none' && computedStyle?.transition !== '';
        if (isTransitioning) {
          return !(computedStyle.display === 'none' || computedStyle.visibility === 'hidden');
        }
        return !(
          computedStyle.display === 'none' ||
          computedStyle.visibility === 'hidden' ||
          computedStyle.opacity === '0' ||
          boundingClientRect.width <= 0 ||
          boundingClientRect.height <= 0
        );
      }
    };

    // --- Styles for each case ---
    function applyTestCaseStyles() {
      // Case 1: Transitioning, display & visibility valid, opacity/size 0
      Object.assign(document.getElementById('case-1').style, {
        transition: 'all 1s', display: 'block', visibility: 'visible', opacity: '0', width: '0px', height: '0px'
      });
      // Case 2: Transitioning, display: none
      Object.assign(document.getElementById('case-2').style, {
        transition: 'opacity 1s', display: 'none', visibility: 'visible', opacity: '1', width: '100px', height: '40px'
      });
      // Case 3: Transitioning, visibility: hidden
      Object.assign(document.getElementById('case-3').style, {
        transition: 'opacity 1s', display: 'block', visibility: 'hidden', opacity: '1', width: '100px', height: '40px'
      });
      // Case 4: Not transitioning, fully visible
      Object.assign(document.getElementById('case-4').style, {
        transition: 'none', display: 'block', visibility: 'visible', opacity: '1', width: '100px', height: '100px'
      });
      // Case 5: Not transitioning, opacity: 0
      Object.assign(document.getElementById('case-5').style, {
        transition: 'none', display: 'block', visibility: 'visible', opacity: '0', width: '100px', height: '40px'
      });
      // Case 6: Not transitioning, width/height: 0
      Object.assign(document.getElementById('case-6').style, {
        transition: 'none', display: 'block', visibility: 'visible', opacity: '1', width: '0px', height: '0px'
      });
      // Case 7: Empty transition, opacity: 0
      Object.assign(document.getElementById('case-7').style, {
        transition: '', display: 'block', visibility: 'visible', opacity: '0', width: '100px', height: '40px'
      });
      // Case 8: Transitioning on unrelated property, all good
      Object.assign(document.getElementById('case-8').style, {
        transition: 'background 1s', display: 'block', visibility: 'visible', opacity: '0', width: '100px', height: '40px'
      });
    }
    applyTestCaseStyles();

    // --- Logging ---
    function log(msg) {
      const logArea = document.getElementById('log-area');
      logArea.textContent += msg + '\n';
      logArea.scrollTop = logArea.scrollHeight;
    }
    function clearResults() {
      for (let i = 1; i <= 10; i++) {
        document.getElementById('msg-' + i).textContent = '';
      }
      document.getElementById('log-area').textContent = '';
    }

    // --- Click Handler ---
    function handleBoxClick(e, caseNum) {
      const el = e.currentTarget;
      const computedStyle = window.getComputedStyle(el);
      const boundingClientRect = el.getBoundingClientRect();
      const isTransitioning = computedStyle.transition !== 'none' && computedStyle.transition !== '';
      const isVisible = deadClickUtils.isNodeVisible(el);
      const deadClick = !isVisible;
      // Log to console.group
      console.group(`Case ${caseNum} Clicked`);
      console.log('Element:', el);
      console.log('Is transitioning:', isTransitioning);
      console.log('display:', computedStyle.display);
      console.log('visibility:', computedStyle.visibility);
      console.log('opacity:', computedStyle.opacity);
      console.log('transition:', computedStyle.transition);
      console.log('width:', computedStyle.width);
      console.log('height:', computedStyle.height);
      console.log('isNodeVisible:', isVisible);
      console.log('Dead click:', deadClick);
      console.groupEnd();
      // Show result in UI
      const msg = document.getElementById('msg-' + caseNum);
      msg.textContent = (isVisible ? 'Visible (Not Dead)' : 'Dead Click');
      msg.style.color = isVisible ? 'green' : 'red';
      // Log to log area
      log(`Case ${caseNum}: isTransitioning=${isTransitioning}, display=${computedStyle.display}, visibility=${computedStyle.visibility}, opacity=${computedStyle.opacity}, transition=${computedStyle.transition}, width=${computedStyle.width}, height=${computedStyle.height}, isNodeVisible=${isVisible}, DeadClick=${deadClick}`);
    }

    // --- Attach click handlers ---
    for (let i = 1; i <= 8; i++) {
      document.getElementById('case-' + i).addEventListener('click', e => handleBoxClick(e, i));
    }

    // --- Case 9: Not an HTMLElement (text node) ---
    function testCase9() {
      const textNode = document.createTextNode('not-an-element');
      const isVisible = deadClickUtils.isNodeVisible(textNode);
      const deadClick = !isVisible;
      console.group('Case 9: Not an HTMLElement (text node)');
      console.log('Node:', textNode);
      console.log('isNodeVisible:', isVisible);
      console.log('Dead click:', deadClick);
      console.groupEnd();
      const msg = document.getElementById('msg-9');
      msg.textContent = (isVisible ? 'Visible (Not Dead)' : 'Dead Click');
      msg.style.color = isVisible ? 'green' : 'red';
      log(`Case 9: Not an HTMLElement (text node), isNodeVisible=${isVisible}, DeadClick=${deadClick}`);
    }
    // --- Case 10: Node is null/undefined ---
    function testCase10() {
      const isVisible = deadClickUtils.isNodeVisible(null);
      const deadClick = !isVisible;
      console.group('Case 10: Node is null/undefined');
      console.log('Node:', null);
      console.log('isNodeVisible:', isVisible);
      console.log('Dead click:', deadClick);
      console.groupEnd();
      const msg = document.getElementById('msg-10');
      msg.textContent = (isVisible ? 'Visible (Not Dead)' : 'Dead Click');
      msg.style.color = isVisible ? 'green' : 'red';
      log(`Case 10: Node is null/undefined, isNodeVisible=${isVisible}, DeadClick=${deadClick}`);
    }
  </script>
</body>
</html> 