<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dead Click Visibility Test</title>
  <!-- Start VWO Async SmartCode -->
  <script type="text/javascript" id="vwoCode">
    // Function to get ID from URL
    function getVWOAccountId() {
      const params = new URLSearchParams(window.location.search);
      const urlId = params.get('id');
      const isSync = window.location.href.includes('sync');
      // If URL has an ID parameter, use that
      if (urlId) {
        return urlId;
      }
      // Default ID if none specified
      return '814397';
    }
    if (window.location.href.includes('sync')) {
      var script = document.createElement('script');
      script.type = 'text/javascript';
      script.src = 'https://dev.visualwebsiteoptimizer.com/lib/' + getVWOAccountId() + '.js';
      script.id = 'vwoCode';
      script.referrerPolicy = 'no-referrer-when-downgrade';
      document.head.appendChild(script);
      var anotherScript = document.createElement('script');
      anotherScript.type = 'text/javascript';
      anotherScript.src = 'path/to/your/other/script.js';
      document.head.appendChild(anotherScript);
    } else {
      window._vwo_code = window._vwo_code || (function() {
        var account_id = getVWOAccountId(),
            version = 1.5,
            settings_tolerance = 2000,
            library_tolerance = 2500,
            use_existing_jquery = false,
            is_spa = 1,
            hide_element = "body",
            hide_element_style = "opacity:0 !important;filter:alpha(opacity=0) !important;background:none !important";
        var f = false,
            d = document,
            vwoCodeEl = d.querySelector("#vwoCode"),
            code = {
              use_existing_jquery: function() { return use_existing_jquery; },
              library_tolerance: function() { return library_tolerance; },
              hide_element_style: function() { return "{" + hide_element_style + "}"; },
              finish: function() {
                if (!f) {
                  f = true;
                  var e = d.getElementById("_vis_opt_path_hides");
                  if (e) e.parentNode.removeChild(e);
                }
              },
              finished: function() { return f; },
              load: function(e) {
                var t = d.createElement("script");
                t.fetchPriority = "high";
                t.src = e;
                t.type = "text/javascript";
                t.onerror = function() { _vwo_code.finish(); };
                d.getElementsByTagName("head")[0].appendChild(t);
              },
              getVersion: function() { return version; },
              getMatchedCookies: function(e) {
                var t = [];
                if (document.cookie) { t = document.cookie.match(e) || []; }
                return t;
              },
              getCombinationCookie: function() {
                var e = code.getMatchedCookies(/(?:^|;)\s?(_vis_opt_exp_\d+_combi=[^;$]*)/gi);
                e = e.map(function(e) {
                  try {
                    var t = decodeURIComponent(e);
                    if (!/_vis_opt_exp_\d+_combi=(?:\d+,?)+\s*$/.test(t)) { return ""; }
                    return t;
                  } catch (e) { return ""; }
                });
                var i = [];
                e.forEach(function(e) {
                  var t = e.match(/([\d,]+)/g);
                  t && i.push(t.join("-"));
                });
                return i.join("|");
              },
              init: function() {
                if (d.URL.indexOf("__vwo_disable__") > -1) return;
                window.settings_timer = setTimeout(function() { _vwo_code.finish(); }, settings_tolerance);
                var e = d.createElement("style"),
                    t = hide_element ? hide_element + "{" + hide_element_style + "}" : "",
                    i = d.getElementsByTagName("head")[0];
                e.setAttribute("id", "_vis_opt_path_hides");
                vwoCodeEl && e.setAttribute("nonce", vwoCodeEl.nonce);
                e.setAttribute("type", "text/css");
                if (e.styleSheet) e.styleSheet.cssText = t;
                else e.appendChild(d.createTextNode(t));
                i.appendChild(e);
                var n = this.getCombinationCookie();
                this.load("https://dev.visualwebsiteoptimizer.com/j.php?a=" + account_id + "&u=" + encodeURIComponent(d.URL) + "&f=" + +is_spa + "&vn=" + version + (n ? "&c=" + n : ""));
                return settings_timer;
              }
            };
        window._vwo_settings_timer = code.init();
        return code;
      })();
      _vwo_pc_custom = { a: 100, t: 100 };
      var jsVar = 1;
      var jaVar = "false";
      document.cookie = "firstName=abc";
    }
  </script>
  <!-- End VWO Async SmartCode -->
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    .test-box {
      width: 150px;
      height: 50px;
      margin: 10px;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border-radius: 6px;
      border: 2px dashed #222;
      outline: 2px solid #ff0;
      min-width: 150px;
      min-height: 50px;
      box-sizing: border-box;
      position: relative;
      z-index: 1;
    }
    #case-1 { background: green; transition: all 1s; opacity: 0; width: 0; height: 0; visibility: visible; display: block; }
    #case-2 { background: red; transition: opacity 1s; display: none; visibility: visible; }
    #case-3 { background: orange; transition: none; opacity: 0; visibility: visible; display: block; }
    #case-4 { background: blue; transition: none; opacity: 1; visibility: visible; display: block; }
    #case-5 { background: purple; transition: ''; opacity: 0; display: block; visibility: visible; }
  </style>
</head>
<body>

  <h2>Dead Click Visibility Testing</h2>
  <p>Click on any box to check if it's considered <strong>visible</strong> or a <strong>dead click</strong>.</p>

  <div id="case-1" class="test-box">Case 1: Transitioning, Visible</div>
  <div id="case-2" class="test-box">Case 2: Transitioning, Display None</div>
  <div id="case-3" class="test-box">Case 3: Not Transitioning, Opacity 0</div>
  <div id="case-4" class="test-box">Case 4: Fully Visible</div>
  <div id="case-5" class="test-box">Case 5: Transition Empty, Opacity 0</div>

  <script>
    const deadClickUtils = {
      isNodeVisible(node) {
        if (!node || !(node instanceof HTMLElement)) {
          return false;
        }

        const computedStyle = window.getComputedStyle(node);
        const boundingClientRect = node.getBoundingClientRect();

        const isTransitioning =
          computedStyle?.transition !== 'none' && computedStyle?.transition !== '';

        if (isTransitioning) {
          return !(computedStyle.display === 'none' || computedStyle.visibility === 'hidden');
        }

        return !(
          computedStyle.display === 'none' ||
          computedStyle.visibility === 'hidden' ||
          computedStyle.opacity === '0' ||
          boundingClientRect.width <= 0 ||
          boundingClientRect.height <= 0
        );
      }
    };

    function logClickResult(e) {
      const el = e.currentTarget;
      const id = el.id;
      const visible = deadClickUtils.isNodeVisible(el);
      const rect = el.getBoundingClientRect();
      const computedStyle = window.getComputedStyle(el);

      console.group(`Clicked: ${id}`);
      console.log("Visible (according to isNodeVisible):", visible);
      console.log("Dead Click:", visible ? "No" : "Yes");
      console.log("Display:", computedStyle.display);
      console.log("Visibility:", computedStyle.visibility);
      console.log("Opacity:", computedStyle.opacity);
      console.log("Transition:", computedStyle.transition);
      console.log("Bounding Box:", { width: rect.width, height: rect.height });
      console.groupEnd();
    }

    document.querySelectorAll(".test-box").forEach(el => {
      el.addEventListener("click", logClickResult);
    });
  </script>
</body>
</html> 